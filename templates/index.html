<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI ì œí’ˆ ë¶„ì„ ë¦¬í¬íŠ¸</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
:root{
--bg:#f4f6fb;
--card:#ffffff;
--primary:#4f46e5;
--text:#1f2937;
--sub:#6b7280;
--border:#e5e7eb;
--shadow:0 20px 50px rgba(0,0,0,0.08);
}

[data-theme="dark"]{
--bg:#111827;
--card:#1f2937;
--text:#f9fafb;
--sub:#9ca3af;
--border:#374151;
--shadow:0 20px 50px rgba(0,0,0,0.4);
}

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:var(--bg);
color:var(--text);
transition:.3s;
}

.container{
max-width:1000px;
margin:60px auto;
padding:40px;
background:var(--card);
border-radius:20px;
box-shadow:var(--shadow);
}

h1{
text-align:center;
margin-bottom:10px;
}

.sub{
text-align:center;
color:var(--sub);
margin-bottom:40px;
}

.input-wrap{
display:flex;
gap:10px;
margin-bottom:30px;
}

input{
flex:1;
padding:15px;
border-radius:12px;
border:1px solid var(--border);
font-size:16px;
}

button{
padding:15px 25px;
border:none;
border-radius:12px;
background:var(--primary);
color:white;
font-weight:600;
cursor:pointer;
}

button.secondary{
background:#6b7280;
}

.progress{
height:6px;
background:var(--border);
border-radius:3px;
overflow:hidden;
margin:20px 0;
display:none;
}

.progress-bar{
height:100%;
width:0%;
background:var(--primary);
transition:.4s;
}

.result{
margin-top:40px;
line-height:1.8;
}

.score-card{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
gap:20px;
margin:30px 0;
}

.score-box{
padding:20px;
border-radius:16px;
background:var(--bg);
text-align:center;
}

.score-box h3{
margin:0;
font-size:14px;
color:var(--sub);
}

.score-value{
font-size:28px;
font-weight:700;
margin-top:5px;
color:var(--primary);
}

.toggle{
position:absolute;
top:20px;
right:20px;
cursor:pointer;
font-size:14px;
color:var(--sub);
}
</style>
</head>
<body>

<div class="toggle" onclick="toggleTheme()">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</div>

<div class="container">
<h1>AI ì œí’ˆ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
<p class="sub">ì‹¤ì œ ë¦¬ë·° ê¸°ë°˜ ì •ë°€ ì ìˆ˜ ë¶„ì„</p>

<div class="input-wrap">
<input id="product" placeholder="ì œí’ˆëª… ì…ë ¥ (ì˜ˆ: ì•„ì´í° 15)">
<button onclick="analyze()">ë¶„ì„ ì‹œì‘</button>
</div>

<div class="progress">
<div class="progress-bar" id="bar"></div>
</div>

<div id="result" class="result"></div>
</div>

<script>
function toggleTheme(){
const html=document.documentElement;
html.dataset.theme=html.dataset.theme==="dark"?"light":"dark";
}

async function analyze(){
const name=document.getElementById("product").value.trim();
if(!name) return;

const result=document.getElementById("result");
const bar=document.getElementById("bar");
document.querySelector(".progress").style.display="block";
bar.style.width="5%";
result.innerHTML="";

const evtSource=new EventSource(`/analyze?product=${encodeURIComponent(name)}`);

evtSource.onmessage=function(event){
const data=JSON.parse(event.data);

if(data.p){
bar.style.width=data.p+"%";
}

if(data.answer){
renderReport(data.answer);
evtSource.close();
}
};

evtSource.onerror=function(){
evtSource.close();
result.innerHTML="<p style='color:red;'>ì˜¤ë¥˜ ë°œìƒ</p>";
};
}

function renderReport(md){
const html=marked.parse(md);
document.getElementById("result").innerHTML=html;
}
</script>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì œí’ˆ ë¶„ì„ê¸°</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        :root {
            --primary: #1a73e8;
            --bg: #f8f9fa;
            --border: #e0e0e0;
            --text: #202124;
            --radius: 12px;
        }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 800px; margin: 40px auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .header { text-align: center; margin-bottom: 30px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 15px; border: 2px solid var(--border); border-radius: var(--radius); font-size: 16px; }
        button { padding: 0 25px; background: var(--primary); color: white; border: none; border-radius: var(--radius); font-weight: 600; cursor: pointer; }
        button:disabled { background: #ccc; }

        /* ì§„í–‰ë°” */
        .progress-wrapper { display: none; margin: 20px 0; padding: 20px; background: #f1f3f4; border-radius: var(--radius); }
        .progress-container { width: 100%; height: 8px; background: #ddd; border-radius: 4px; overflow: hidden; margin: 10px 0; }
        .progress-fill { width: 0%; height: 100%; background: var(--primary); transition: width 0.3s ease; }
        
        /* ê²°ê³¼ì°½ */
        .result-container { margin-top: 20px; padding: 25px; border-radius: var(--radius); border: 1px solid var(--border); min-height: 100px; line-height: 1.8; }
        #result h1, #result h2 { color: var(--primary); margin-top: 20px; }
        #result ul { padding-left: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>AI ì œí’ˆ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
        <p>ì‹¤ì œ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
    </div>

    <div class="input-group">
        <input type="text" id="pName" placeholder="ì œí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê°¤ëŸ­ì‹œ S24)">
        <button id="analyzeBtn" onclick="run()">ë¦¬í¬íŠ¸ ìƒì„±</button>
    </div>

    <div id="progressWrapper" class="progress-wrapper">
        <div style="display:flex; justify-content:space-between; font-size:14px;">
            <span id="stepMsg">ì¤€ë¹„ ì¤‘...</span>
            <span id="percentText">0%</span>
        </div>
        <div class="progress-container">
            <div id="progressFill" class="progress-fill"></div>
        </div>
    </div>

    <div class="result-container">
        <div id="result">ì œí’ˆëª…ì„ ì…ë ¥í•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
    </div>
</div>

<script>
    let isAnalyzing = false;

    async function run() {
        const pName = document.getElementById('pName').value.trim();
        if (!pName || isAnalyzing) return;

        // UI ìš”ì†Œ
        const btn = document.getElementById('analyzeBtn');
        const wrapper = document.getElementById('progressWrapper');
        const fill = document.getElementById('progressFill');
        const percent = document.getElementById('percentText');
        const msg = document.getElementById('stepMsg');
        const resultDiv = document.getElementById('result');

        isAnalyzing = true;
        btn.disabled = true;
        wrapper.style.display = 'block';
        resultDiv.style.opacity = '0.5';
        resultDiv.innerHTML = "ë°ì´í„° ìˆ˜ì§‘ ë° ë¦¬í¬íŠ¸ ìƒì„± ì¤‘...";

        // SSE ì—°ê²° (ë°±ì—”ë“œ /analyze í˜¸ì¶œ)
        // âš ï¸ Render ë°°í¬ ì‹œ ì‹¤ì œ URLì„ ë„£ê±°ë‚˜ ìƒëŒ€ ê²½ë¡œë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
        const eventSource = new EventSource(`/analyze?product=${encodeURIComponent(pName)}`);

        eventSource.onmessage = (event) => {
            const data = JSON.parse(event.data);

            // ì‹¤ì‹œê°„ ì§„í–‰ë°” ì—…ë°ì´íŠ¸
            fill.style.width = data.p + '%';
            percent.innerText = data.p + '%';
            msg.innerText = data.m;

            // ì™„ë£Œ ì‹œ ê²°ê³¼ ì¶œë ¥
            if (data.p === 100 && data.answer) {
                eventSource.close();
                setTimeout(() => {
                    wrapper.style.display = 'none';
                    // ë§ˆí¬ë‹¤ìš´ ë³€í™˜ í›„ 'result' ID ì˜ì—­ì— ì¶œë ¥
                    resultDiv.innerHTML = marked.parse(data.answer);
                    resultDiv.style.opacity = '1';
                    isAnalyzing = false;
                    btn.disabled = false;
                }, 500);
            }

            if (data.error) {
                eventSource.close();
                alert("ì˜¤ë¥˜: " + data.m);
                isAnalyzing = false;
                btn.disabled = false;
                resultDiv.innerHTML = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
            }
        };

        eventSource.onerror = () => {
            eventSource.close();
            console.error("SSE Connection Failed");
            isAnalyzing = false;
            btn.disabled = false;
        };
    }
</script>

</body>
</html>
</body>
</html>
